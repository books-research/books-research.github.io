<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ThreadSafeConcatenation - Java Data Structures and Algorithms for Beginners</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/ferris.css">
        <link rel="stylesheet" href="../../theme/semantic-notes.css">
        <link rel="stylesheet" href="../../theme/listing.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Java Data Structures and Algorithms for Beginners</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <style>
body {
  text-align: justify;
}
</style>
<h1 id="thread-safe-concatenation"><a class="header" href="#thread-safe-concatenation">Thread-Safe Concatenation</a></h1>
<h2 id="problem-statement"><a class="header" href="#problem-statement">Problem Statement</a></h2>
<p>Write a Java program that implements a multi-threaded application using StringBuffer to append strings concurrently from multiple threads, ensuring thread safety. The program should allow multiple threads to append strings to a shared StringBuffer and verify that the resulting string is correct, demonstrating thread safety. Test the implementation with various scenarios, including different numbers of threads, varying string lengths, and edge cases like empty strings. You can visualize this as a team of workers adding their notes to a shared, synchronized logbook, ensuring that no notes are lost or jumbled even when everyone writes at the same time.</p>
<p><strong>Input</strong>: A set of strings to be appended by multiple threads (e.g., <code>["thread1", "thread2", "thread3"]</code>).
<strong>Output</strong>: A single string containing all appended strings in the order of thread execution (e.g., <code>"thread1thread2thread3"</code>) and verification of correctness.
<strong>Constraints</strong>:</p>
<ul>
<li>Number of threads is between 1 and 100.</li>
<li>Each string contains printable ASCII characters and may be empty.</li>
<li>The input strings may be null (handled by skipping or appending a default value).
<strong>Example</strong>:</li>
<li>Input: 3 threads appending <code>"thread1"</code>, <code>"thread2"</code>, <code>"thread3"</code>.</li>
<li>Output: <code>"thread1thread2thread3"</code> (order may vary due to thread scheduling).</li>
<li>Explanation: Each thread appends its string to a shared StringBuffer, and the result is consistent due to StringBuffer’s thread-safe methods.</li>
<li>Input: 2 threads appending <code>""</code>, <code>""</code>.</li>
<li>Output: <code>""</code></li>
<li>Explanation: Empty strings result in an empty final string.</li>
</ul>
<h2 id="pseudocode"><a class="header" href="#pseudocode">Pseudocode</a></h2>
<pre><code>FUNCTION appendString(buffer, str)
    IF str is not null THEN
        CALL buffer.append(str)
    ENDIF
ENDFUNCTION

FUNCTION threadSafeConcatenation(strings, numThreads)
    IF strings is null OR numThreads &lt;= 0 THEN
        RETURN null
    ENDIF
    CREATE sharedBuffer as new StringBuffer
    CREATE threadList as empty list
    FOR i from 0 to numThreads - 1
        CREATE thread that calls appendString(sharedBuffer, strings[i])
        ADD thread to threadList
    ENDFOR
    FOR each thread in threadList
        START thread
    ENDFOR
    FOR each thread in threadList
        JOIN thread
    ENDFOR
    RETURN sharedBuffer as string
ENDFUNCTION

FUNCTION main()
    SET testCases to array of (strings, numThreads) pairs
    FOR each (strings, numThreads) in testCases
        PRINT test case details
        CALL threadSafeConcatenation(strings, numThreads)
        PRINT resulting string
        VERIFY result correctness
    ENDFOR
ENDFUNCTION
</code></pre>
<h2 id="algorithm-steps"><a class="header" href="#algorithm-steps">Algorithm Steps</a></h2>
<ol>
<li>Define a method <code>appendString</code> that safely appends a string to a shared StringBuffer.</li>
<li>Define a method <code>threadSafeConcatenation</code>:
a. Check for null input or invalid thread count; return null if invalid.
b. Create a shared StringBuffer.
c. Create and start threads, each calling <code>appendString</code> with a string.
d. Wait for all threads to complete using <code>join</code>.
e. Return the final concatenated string.</li>
<li>Verify thread safety by checking if the result contains all input strings in any order (since thread scheduling is non-deterministic).</li>
<li>In the <code>main</code> method, test with different numbers of threads, string lengths, and edge cases (e.g., empty strings, single thread), printing the input, output, and verification results.</li>
</ol>
<h2 id="java-implementation"><a class="header" href="#java-implementation">Java Implementation</a></h2>
<pre><code class="language-java">import java.util.ArrayList;

public class ThreadSafeConcatenation {
    // Appends a string to the shared StringBuffer
    private void appendString(StringBuffer buffer, String str) {
        if (str != null) {
            buffer.append(str);
        }
    }

    // Performs thread-safe concatenation using multiple threads
    public String threadSafeConcatenation(String[] strings, int numThreads) {
        if (strings == null || numThreads &lt;= 0 || numThreads &gt; strings.length) {
            return null;
        }
        StringBuffer sharedBuffer = new StringBuffer();
        ArrayList&lt;Thread&gt; threadList = new ArrayList&lt;&gt;();
        
        // Create threads
        for (int i = 0; i &lt; numThreads; i++) {
            final String str = strings[i];
            Thread thread = new Thread(() -&gt; appendString(sharedBuffer, str));
            threadList.add(thread);
        }
        
        // Start all threads
        for (Thread thread : threadList) {
            thread.start();
        }
        
        // Wait for all threads to complete
        for (Thread thread : threadList) {
            try {
                thread.join();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
        
        return sharedBuffer.toString();
    }

    // Main method to test thread-safe concatenation
    public static void main(String[] args) {
        ThreadSafeConcatenation concatenator = new ThreadSafeConcatenation();

        // Test cases
        Object[][] testCases = {
            {new String[]{"thread1", "thread2", "thread3"}, 3}, // Multiple threads
            {new String[]{"", ""}, 2},                         // Empty strings
            {new String[]{"solo"}, 1},                        // Single thread
            {generateLargeStrings(10), 10},                   // Large input
            {new String[]{null, "test", null}, 3},            // Null elements
            {null, 1}                                         // Null input
        };

        for (int i = 0; i &lt; testCases.length; i++) {
            String[] strings = (String[]) testCases[i][0];
            int numThreads = (int) testCases[i][1];
            System.out.println("Test case " + (i + 1) + ":");
            System.out.print("Input strings: [");
            if (strings != null) {
                for (int j = 0; j &lt; numThreads &amp;&amp; j &lt; strings.length; j++) {
                    System.out.print(strings[j] != null ? "\"" + strings[j] + "\"" : "null");
                    if (j &lt; numThreads - 1 &amp;&amp; j &lt; strings.length - 1) {
                        System.out.print(", ");
                    }
                }
            } else {
                System.out.print("null");
            }
            System.out.println("]");
            System.out.println("Number of threads: " + numThreads);
            String result = concatenator.threadSafeConcatenation(strings, numThreads);
            System.out.println("Concatenated result: \"" + (result != null &amp;&amp; result.length() &gt; 50 ? result.substring(0, 50) + "..." : result) + "\"");
            // Verify correctness
            if (strings != null &amp;&amp; result != null) {
                StringBuilder expected = new StringBuilder();
                for (int j = 0; j &lt; numThreads &amp;&amp; j &lt; strings.length; j++) {
                    if (strings[j] != null) {
                        expected.append(strings[j]);
                    }
                }
                System.out.println("Verification: " + (result.length() == expected.length() ? "Correct (length matches expected)" : "Incorrect"));
            } else {
                System.out.println("Verification: " + (result == null ? "Correct (null expected)" : "Incorrect"));
            }
            System.out.println();
        }
    }

    // Helper method to generate large strings for testing
    private static String[] generateLargeStrings(int size) {
        String[] largeStrings = new String[size];
        for (int i = 0; i &lt; size; i++) {
            largeStrings[i] = "str" + i;
        }
        return largeStrings;
    }
}
</code></pre>
<h2 id="output"><a class="header" href="#output">Output</a></h2>
<p>Running the <code>main</code> method produces (note: order of strings in the result may vary due to thread scheduling):</p>
<pre><code>Test case 1:
Input strings: ["thread1", "thread2", "thread3"]
Number of threads: 3
Concatenated result: "thread1thread2thread3"
Verification: Correct (length matches expected)

Test case 2:
Input strings: ["", ""]
Number of threads: 2
Concatenated result: ""
Verification: Correct (length matches expected)

Test case 3:
Input strings: ["solo"]
Number of threads: 1
Concatenated result: "solo"
Verification: Correct (length matches expected)

Test case 4:
Input strings: ["str0", "str1", "str2", ..., "str9"]
Number of threads: 10
Concatenated result: "str0str1str2str3str4str5str6str7str8str9"
Verification: Correct (length matches expected)

Test case 5:
Input strings: [null, "test", null]
Number of threads: 3
Concatenated result: "test"
Verification: Correct (length matches expected)

Test case 6:
Input strings: [null]
Number of threads: 1
Concatenated result: "null"
Verification: Correct (null expected)
</code></pre>
<p>Explanation:</p>
<ul>
<li>Test case 1: Three threads append <code>"thread1"</code>, <code>"thread2"</code>, <code>"thread3"</code>; result is correct (order may vary).</li>
<li>Test case 2: Two threads append empty strings; result is empty.</li>
<li>Test case 3: One thread appends <code>"solo"</code>; result is <code>"solo"</code>.</li>
<li>Test case 4: Ten threads append <code>"str0"</code> to <code>"str9"</code>; result contains all strings.</li>
<li>Test case 5: Three threads, with nulls skipped, append <code>"test"</code>; result is <code>"test"</code>.</li>
<li>Test case 6: Null input returns null.</li>
</ul>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How It Works</a></h2>
<ul>
<li><strong>StringBuffer</strong>: Thread-safe due to synchronized methods, ensuring safe concurrent appends.</li>
<li><strong>appendString</strong>: Appends a non-null string to the shared StringBuffer.</li>
<li><strong>threadSafeConcatenation</strong>:
<ul>
<li>Creates a shared StringBuffer.</li>
<li>Spawns threads, each appending a string.</li>
<li>Waits for all threads to finish using <code>join</code>.</li>
<li>Returns the concatenated string.</li>
</ul>
</li>
<li><strong>Verification</strong>: Checks if the result’s length matches the sum of non-null input string lengths.</li>
<li><strong>Example Trace (Test case 1)</strong>:
<ul>
<li>Initialize: <code>sharedBuffer = ""</code>.</li>
<li>Thread 1 appends <code>"thread1"</code> → <code>sharedBuffer = "thread1"</code>.</li>
<li>Thread 2 appends <code>"thread2"</code> → <code>sharedBuffer = "thread1thread2"</code>.</li>
<li>Thread 3 appends <code>"thread3"</code> → <code>sharedBuffer = "thread1thread2thread3"</code>.</li>
</ul>
</li>
<li><strong>Main Method</strong>: Tests with multiple threads, empty strings, single thread, large inputs, and null cases, verifying thread safety.</li>
<li><strong>Thread Safety</strong>: StringBuffer’s synchronized <code>append</code> method ensures no data corruption.</li>
</ul>
<h2 id="complexity-analysis-table"><a class="header" href="#complexity-analysis-table">Complexity Analysis Table</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Operation</th><th>Time Complexity</th><th>Space Complexity</th></tr></thead><tbody>
<tr><td>Append (per thread)</td><td>O(m)</td><td>O(m)</td></tr>
<tr><td>Full Algorithm</td><td>O(n * m)</td><td>O(n * m)</td></tr>
</tbody></table>
</div>
<p><em>Note</em>:</p>
<ul>
<li>n is the number of threads, m is the average length of each string.</li>
<li>Time complexity: O(m) per append operation; O(n * m) for all threads (though concurrent execution may reduce wall-clock time).</li>
<li>Space complexity: O(n * m) for the StringBuffer storing all concatenated strings.</li>
<li>Worst case: O(n * m) time and space when all strings are long and non-null.</li>
</ul>
<blockquote>
<p><strong>✅ Tip</strong>: Use StringBuffer for thread-safe string concatenation in multi-threaded environments. Test with multiple threads and varying string lengths to confirm thread safety.</p>
</blockquote>
<blockquote>
<p><strong>⚠ Warning</strong>: Ensure proper thread synchronization using <code>join</code> to avoid accessing the StringBuffer before all appends complete. Check for null inputs to prevent unexpected behavior.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../problemStatements/ch03_02_01/StringReversal.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../problemStatements/stackProblemSolving.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../problemStatements/ch03_02_01/StringReversal.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../problemStatements/stackProblemSolving.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/ferris.js"></script>


    </div>
    </body>
</html>
